System.register("chunks:///_virtual/LightScene.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SceneLightMgr.ts"],(function(e){var t,i,r,n,o,a,c,l,p,h,s,u,g,S;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,c=e.Sprite,l=e.Camera,p=e.Size,h=e.screen,s=e.view,u=e.UITransform,g=e.Component},function(e){S=e.SceneLightMgr}],execute:function(){var d,f,w,m,y,v,L;o._RF.push({},"945f3sjtShMTaibGreXN/d9","LightScene",void 0);var b=a.ccclass,z=a.property;e("LightScene",(d=b("LightScene"),f=z(c),w=z(l),d((v=t((y=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,r(t,"topSprite",v,n(t)),r(t,"camera",L,n(t)),t}return i(t,e),t.prototype.onLoad=function(){var e,t=new p(h.windowSize.width/s.getScaleX(),h.windowSize.height/s.getScaleY()),i=null==(e=this.topSprite)?void 0:e.getSharedMaterial(0);S.initMat(i,t.width,t.height,this.camera),this.topSprite.getComponent(u).setContentSize(t.width,t.height)},t}(g)).prototype,"topSprite",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=t(y.prototype,"camera",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=y))||m));o._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./LightScene.ts","./NodeTouchMoveComp.ts","./NodeTouchMoveComp2.ts","./SceneLightComp.ts","./SceneLightMgr.ts","./SceneLightOccluder.ts","./SceneLightSector.ts"],(function(){return{setters:[null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/NodeTouchMoveComp.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var o,e,n,s,i,c,r,p;return{setters:[function(t){o=t.inheritsLoose},function(t){e=t.cclegacy,n=t._decorator,s=t.UITransform,i=t.Node,c=t.Vec2,r=t.Vec3,p=t.Component}],execute:function(){var h;e._RF.push({},"d74fbi6g1JLJb/y5+x+EHR/","NodeTouchMoveComp",void 0);var a=n.ccclass;t("NodeTouchMoveComp",a("NodeTouchMoveComp")(h=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(o=t.call.apply(t,[this].concat(n))||this).parentUI=void 0,o._pos=new c,o._tempV3=new r,o}o(e,t);var n=e.prototype;return n.start=function(){this.parentUI=this.node.parent.getComponent(s),this.node.on(i.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(i.EventType.TOUCH_MOVE,this.onTouchStart,this)},n.onTouchStart=function(t){t.getUILocation(this._pos),this.updateMoveNode()},n.updateMoveNode=function(){this._tempV3.set(this._pos.x,this._pos.y,0),this._tempV3=this.parentUI.convertToNodeSpaceAR(this._tempV3),this.node.setPosition(this._tempV3.x,this._tempV3.y)},e}(p))||h);e._RF.pop()}}}));

System.register("chunks:///_virtual/NodeTouchMoveComp2.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SceneLightSector.ts"],(function(t){var o,e,i,s,n,r,h,p,c,a,l,u;return{setters:[function(t){o=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,s=t.assertThisInitialized},function(t){n=t.cclegacy,r=t._decorator,h=t.Vec2,p=t.Vec3,c=t.UITransform,a=t.Node,l=t.Component},function(t){u=t.SceneLightSector}],execute:function(){var _,d,m,v,y;n._RF.push({},"a3c633I/rpNIbWFi0ly9EP2","NodeTouchMoveComp2",void 0);var T=r.ccclass,f=r.property;t("NodeTouchMoveComp2",(_=T("NodeTouchMoveComp2"),d=f(u),_((y=o((v=function(t){function o(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).parentUI=void 0,i(o,"lightSector",y,s(o)),o._pos=new h(0,0),o._oldPos=new h(0,0),o._tempV2=new h(0,0),o._tempV3=new p,o}e(o,t);var n=o.prototype;return n.start=function(){this.parentUI=this.node.parent.getComponent(c),this.node.on(a.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(a.EventType.TOUCH_MOVE,this.onTouchStart,this)},n.onTouchStart=function(t){if(t.getUILocation(this._pos),this.updateMoveNode(),this._tempV2.set(this._pos.x-this._oldPos.x,this._pos.y-this._oldPos.y),this._tempV2.lengthSqr()>900){var o=180*Math.atan2(this._pos.y-this._oldPos.y,this._pos.x-this._oldPos.x)/Math.PI;this.lightSector.direction=o-90,this._oldPos.set(this._pos)}},n.updateMoveNode=function(){this._tempV3.set(this._pos.x,this._pos.y,0),this._tempV3=this.parentUI.convertToNodeSpaceAR(this._tempV3),this.node.setPosition(this._tempV3.x,this._tempV3.y)},o}(l)).prototype,"lightSector",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=v))||m));n._RF.pop()}}}));

System.register("chunks:///_virtual/SceneLightComp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SceneLightMgr.ts"],(function(t){var e,i,o,n,r,s,a,u,h,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.CCFloat,u=t.NodeEventType,h=t.Component},function(t){c=t.SceneLightMgr}],execute:function(){var l,p,d,f,g,m,y,L,S;r._RF.push({},"252e0ifUM9LMbd+gsKdD0Cr","SceneLightComp",void 0);var _=s.ccclass,b=s.property;t("SceneLightComp",(l=_("SceneLightComp"),p=b({type:a,tooltip:"内圈半径"}),d=b({type:a,tooltip:"外扩宽度"}),f=b({tooltip:"是否生成阴影"}),l((y=e((m=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,o(e,"radius",y,n(e)),o(e,"outLen",L,n(e)),o(e,"isShadow",S,n(e)),e._timer=null,e}i(e,t);var r=e.prototype;return r.onUpdatePos=function(){this.node.active&&c.addLightPos(this.node.uuid,this.node.worldPosition,this.radius,this.outLen,this.isShadow)},r.onEnable=function(){var t=this;this._timer=setTimeout((function(){t._timer=null,t.onUpdatePos()}),100),this.node.on(u.TRANSFORM_CHANGED,this.onUpdatePos,this),this.node.parent.on(u.TRANSFORM_CHANGED,this.onUpdatePos,this)},r.onDisable=function(){c.removeLight(this.node.uuid),this.node.off(u.TRANSFORM_CHANGED,this.onUpdatePos,this),this.node.parent.off(u.TRANSFORM_CHANGED,this.onUpdatePos,this)},r.onDestroy=function(){this._timer&&(clearTimeout(this._timer),this._timer=null),c.removeLight(this.node.uuid)},e}(h)).prototype,"radius",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),L=e(m.prototype,"outLen",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),S=e(m.prototype,"isShadow",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),g=m))||g));r._RF.pop()}}}));

System.register("chunks:///_virtual/SceneLightMgr.ts",["cc"],(function(t){var i,e,h,s,r;return{setters:[function(t){i=t.cclegacy,e=t.Vec3,h=t.screen,s=t.Vec4,r=t.Vec2}],execute:function(){i._RF.push({},"7b3b43PovZAp5Psfo+mdZpW","SceneLightMgr",void 0);var a=t("SceneLightMgr",function(){function t(){}return t.initMat=function(t,i,e,s){this.camera=s,this.width=i,this.height=e,t?(this.material=t,this.material.setProperty("wh_ratio",i/e)):this.material=null,this.radio=this.width/h.windowSize.width,this.lightPosList={},this.lightSectorList={}},t.addLightPos=function(t,i,e,h,r){void 0===r&&(r=!1);var a=this.camera.worldToScreen(i);this.lightPosList[t]=new s(this.radio*a.x/this.width,1-this.radio*a.y/this.height,e/this.width,h/this.width),this.lightShadow[t]=new s(r?1:0,0,0,0),this.updateMaterial()},t.removeLight=function(t){this.lightPosList[t]=null,this.updateMaterial()},t.updateMaterial=function(){if(this.material){var t=[],i=[];for(var e in this.lightPosList){var h=this.lightPosList[e];t.push(h),i.push(this.lightShadow[e])}t.push(new s(-1)),this.material.setProperty("lights",t),this.material.setProperty("lightShadow",i)}},t.addLightSector=function(t,i,e,h,r,a,o,c){if(void 0===c&&(c=!1),this.camera){var n=this.camera.worldToScreen(i);this.lightSectorList[t]=[new s(this.radio*n.x/this.width,1-this.radio*n.y/this.height,e,c?1:0),new s(h/this.width,r/this.height,a,o)],this.updateMatSector()}},t.removeLightSector=function(t){this.lightSectorList[t]=null,this.updateMatSector()},t.updateMatSector=function(){if(this.material){var t=[];for(var i in this.lightSectorList){var e=this.lightSectorList[i];e&&(t.push(e[0]),t.push(e[1]))}t.push(new s(-1)),this.material.setProperty("lightSectors",t)}},t.worldToScreen=function(t){this._tmpVec3.set(t.x,t.y,0);var i=this.camera.worldToScreen(this._tmpVec3);return new r(this.radio*i.x/this.width,1-this.radio*i.y/this.height)},t.addOccluder=function(t,i){for(var e=[],h=0;h<i.length;h++){var r=this.worldToScreen(i[h]);if(0==h)e.push(new s(Math.ceil(i.length/2),(i.length-1)%2,r.x,r.y));else if(h+1<i.length){var a=this.worldToScreen(i[h+1]);e.push(new s(r.x,r.y,a.x,a.y)),h++}else e.push(new s(r.x,r.y)),h++}this.occluderList[t]=e,this.updateMatOccluder()},t.removeOccluder=function(t){this.occluderList[t]=null,this.updateMatOccluder()},t.updateMatOccluder=function(){if(this.material){var t=[];for(var i in this.occluderList){var e=this.occluderList[i];if(e)for(var h=0;h<e.length;h++)t.push(e[h])}t.push(new s(-1)),this.material.setProperty("occluders",t)}},t}());a.lightPosList={},a.material=void 0,a.width=1280,a.height=720,a.camera=void 0,a.radio=1,a.lightShadow={},a.lightSectorList={},a.occluderList={},a._tmpVec3=new e,i._RF.pop()}}}));

System.register("chunks:///_virtual/SceneLightOccluder.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SceneLightMgr.ts"],(function(e){var t,n,o,i,r,s,c,u;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,o=e._decorator,i=e.PolygonCollider2D,r=e.Node,s=e.NodeEventType,c=e.Component},function(e){u=e.SceneLightMgr}],execute:function(){var l;n._RF.push({},"eafa3ai49ZKOZN80PqTXp9O","SceneLightOccluder",void 0);var d=o.ccclass,h=o.requireComponent;e("SceneLightOccluder",d("SceneLightOccluder")(l=h(i)(l=function(e){function n(){for(var t,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(t=e.call.apply(e,[this].concat(o))||this).collider=null,t._timer=null,t}t(n,e);var o=n.prototype;return o.onLoad=function(){this.collider=this.node.getComponent(i)},o.onUpdatePos=function(){this.node.active&&u.addOccluder(this.node.uuid,this.collider.worldPoints)},o.onPosChange=function(e){e&r.TransformBit.POSITION&&this.onUpdatePos()},o.onEnable=function(){var e=this;this._timer=setTimeout((function(){e._timer=null,e.onUpdatePos()}),100),this.node.on(s.TRANSFORM_CHANGED,this.onUpdatePos,this),this.node.parent.on(s.TRANSFORM_CHANGED,this.onUpdatePos,this)},o.onDisable=function(){u.removeOccluder(this.node.uuid),this.node.off(s.TRANSFORM_CHANGED,this.onUpdatePos,this),this.node.parent.off(s.TRANSFORM_CHANGED,this.onUpdatePos,this)},o.onDestroy=function(){this._timer&&(clearTimeout(this._timer),this._timer=null),u.removeOccluder(this.node.uuid)},n}(c))||l)||l);n._RF.pop()}}}));

System.register("chunks:///_virtual/SceneLightSector.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SceneLightMgr.ts"],(function(t){var e,i,o,r,n,s,a,p,u,c,l,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,r=t.assertThisInitialized,n=t.createClass},function(t){s=t.cclegacy,a=t._decorator,p=t.CCFloat,u=t.CCBoolean,c=t.NodeEventType,l=t.Component},function(t){h=t.SceneLightMgr}],execute:function(){var d,y,g,_,f,b,S,w,P,m,E,O,D,z,v,L,U,C,x,R,W;s._RF.push({},"240dfEgy55KrLGZGpEyWyCh","SceneLightSector",void 0);var A=a.ccclass,N=a.property;t("SceneLightSector",(d=A("SceneLightSector"),y=N({serializable:!0}),g=N({serializable:!0}),_=N({serializable:!0}),f=N({serializable:!0}),b=N({serializable:!0}),S=N({serializable:!0}),w=N({type:p,tooltip:"朝向 (0-360)"}),P=N({type:p,tooltip:"半径"}),m=N({type:p,tooltip:"外扩宽度"}),E=N({type:p,tooltip:"张开角度"}),O=N({type:p,tooltip:"外拓角度"}),D=N({type:u,tooltip:"是否产生阴影"}),d((L=e((v=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return e=t.call.apply(t,[this].concat(n))||this,o(e,"_direction",L,r(e)),o(e,"_radius",U,r(e)),o(e,"_outerWidth",C,r(e)),o(e,"_angle",x,r(e)),o(e,"_angleEx",R,r(e)),o(e,"_isShadow",W,r(e)),e._timer=null,e}i(e,t);var s=e.prototype;return s.onUpdatePos=function(){this.node.active&&h.addLightSector(this.node.uuid,this.node.worldPosition,this._direction,this.radius,this.outerWidth,this.angle,this.angleEx,this.isShadow)},s.onEnable=function(){var t=this;this._timer=setTimeout((function(){t._timer=null,t.onUpdatePos()}),100),this.node.on(c.TRANSFORM_CHANGED,this.onUpdatePos,this),this.node.parent.on(c.TRANSFORM_CHANGED,this.onUpdatePos,this)},s.onDisable=function(){h.removeLightSector(this.node.uuid),this.node.off(c.TRANSFORM_CHANGED,this.onUpdatePos,this),this.node.parent.off(c.TRANSFORM_CHANGED,this.onUpdatePos,this)},s.onDestroy=function(){this._timer&&(clearTimeout(this._timer),this._timer=null),h.removeLightSector(this.node.uuid)},n(e,[{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this.onUpdatePos())}},{key:"radius",get:function(){return this._radius},set:function(t){this._radius!==t&&(this._radius=t,this.onUpdatePos())}},{key:"outerWidth",get:function(){return this._outerWidth},set:function(t){this._outerWidth!==t&&(this._outerWidth=t,this.onUpdatePos())}},{key:"angle",get:function(){return this._angle},set:function(t){this._angle!==t&&(this._angle=t,this.onUpdatePos())}},{key:"angleEx",get:function(){return this._angleEx},set:function(t){this._angleEx!==t&&(this._angleEx=t,this.onUpdatePos())}},{key:"isShadow",get:function(){return this._isShadow},set:function(t){this._isShadow!==t&&(this._isShadow=t,this.onUpdatePos())}}]),e}(l)).prototype,"_direction",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),U=e(v.prototype,"_radius",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),C=e(v.prototype,"_outerWidth",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),x=e(v.prototype,"_angle",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),R=e(v.prototype,"_angleEx",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),W=e(v.prototype,"_isShadow",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),e(v.prototype,"direction",[w],Object.getOwnPropertyDescriptor(v.prototype,"direction"),v.prototype),e(v.prototype,"radius",[P],Object.getOwnPropertyDescriptor(v.prototype,"radius"),v.prototype),e(v.prototype,"outerWidth",[m],Object.getOwnPropertyDescriptor(v.prototype,"outerWidth"),v.prototype),e(v.prototype,"angle",[E],Object.getOwnPropertyDescriptor(v.prototype,"angle"),v.prototype),e(v.prototype,"angleEx",[O],Object.getOwnPropertyDescriptor(v.prototype,"angleEx"),v.prototype),e(v.prototype,"isShadow",[D],Object.getOwnPropertyDescriptor(v.prototype,"isShadow"),v.prototype),z=v))||z));s._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});