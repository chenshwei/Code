System.register("chunks:///_virtual/LightScene.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SceneLightMgr.ts"],(function(e){var t,i,o,n,r,a,s,h,c,p,l,u,d,S,g,f,w;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,o=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){r=e.cclegacy,a=e._decorator,s=e.Node,h=e.Sprite,c=e.Camera,p=e.Vec2,l=e.Size,u=e.screen,d=e.view,S=e.UITransform,g=e.sys,f=e.Component},function(e){w=e.SceneLightMgr}],execute:function(){var v,y,m,b,T,_,z,L,M;r._RF.push({},"945f3sjtShMTaibGreXN/d9","LightScene",void 0);var N=a.ccclass,V=a.property;e("LightScene",(v=N("LightScene"),y=V(s),m=V(h),b=V(c),v((z=t((_=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,o(t,"moveNode",z,n(t)),o(t,"topSprite",L,n(t)),o(t,"camera",M,n(t)),t.dfV2=new p,t._pos=new p,t}i(t,e);var r=t.prototype;return r.onLoad=function(){var e=new l(u.windowSize.width/d.getScaleX(),u.windowSize.height/d.getScaleY()),t=this.topSprite.material;w.initMat(t,e.width,e.height,this.camera),this.topSprite.getComponent(S).setContentSize(e.width,e.height)},r.start=function(){var e=g.getSafeAreaRect(),t=new l(u.windowSize.width/d.getScaleX(),u.windowSize.height/d.getScaleY());this.dfV2.x=t.width/2-Math.abs(e.x),this.dfV2.y=t.height/2,this.moveNode&&(this.node.on(s.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(s.EventType.TOUCH_MOVE,this.onTouchStart,this))},r.onTouchStart=function(e){e.getUILocation(this._pos),this.updateMoveNode()},r.updateMoveNode=function(){this._pos.x-=this.dfV2.x,this._pos.y-=this.dfV2.y,this.moveNode.setPosition(this._pos.x,this._pos.y)},t}(f)).prototype,"moveNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=t(_.prototype,"topSprite",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=t(_.prototype,"camera",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=_))||T));r._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./LightScene.ts","./SceneLightComp.ts","./SceneLightMgr.ts","./SceneLightObstacle.ts"],(function(){return{setters:[null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/SceneLightComp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SceneLightMgr.ts"],(function(t){var e,i,o,n,r,s,u,a,c,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,u=t.CCFloat,a=t.NodeEventType,c=t.Component},function(t){h=t.SceneLightMgr}],execute:function(){var p,l,d,f,g,m,L;r._RF.push({},"252e0ifUM9LMbd+gsKdD0Cr","SceneLightComp",void 0);var y=s.ccclass,_=s.property;t("SceneLightComp",(p=y("SceneLightComp"),l=_({type:u,tooltip:"内圈半径"}),d=_({type:u,tooltip:"外扩宽度"}),p((m=e((g=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,o(e,"radius",m,n(e)),o(e,"outLen",L,n(e)),e._timer=null,e}i(e,t);var r=e.prototype;return r.onUpdatePos=function(){this.node.active&&h.addLightPos(this.node.uuid,this.node.worldPosition,this.radius,this.outLen)},r.onEnable=function(){var t=this;this._timer=setTimeout((function(){t._timer=null,t.onUpdatePos()}),100),this.node.on(a.TRANSFORM_CHANGED,this.onUpdatePos,this),this.node.parent.on(a.TRANSFORM_CHANGED,this.onUpdatePos,this)},r.onDisable=function(){h.removeLight(this.node.uuid),this.node.off(a.TRANSFORM_CHANGED,this.onUpdatePos,this),this.node.parent.off(a.TRANSFORM_CHANGED,this.onUpdatePos,this)},r.onDestroy=function(){this._timer&&(clearTimeout(this._timer),this._timer=null),h.removeLight(this.node.uuid)},e}(c)).prototype,"radius",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),L=e(g.prototype,"outLen",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),f=g))||f));r._RF.pop()}}}));

System.register("chunks:///_virtual/SceneLightMgr.ts",["cc"],(function(t){var i,e,s,h,a;return{setters:[function(t){i=t.cclegacy,e=t.Vec3,s=t.screen,h=t.Vec4,a=t.Vec2}],execute:function(){i._RF.push({},"7b3b43PovZAp5Psfo+mdZpW","SceneLightMgr",void 0);var r=t("SceneLightMgr",function(){function t(){}return t.initMat=function(t,i,e,h){this.camera=h,this.material=t,this.width=i,this.height=e,this.material.setProperty("wh_ratio",i/e),this.radio=this.width/s.windowSize.width,this.lightPosList={}},t.addLightPos=function(t,i,e,s){var a=this.camera.worldToScreen(i);this.lightPosList[t]=new h(this.radio*a.x/this.width,1-this.radio*a.y/this.height,e/this.width,s/this.width),this.updateMaterial()},t.removeLight=function(t){this.lightPosList[t]=null,this.updateMaterial()},t.updateMaterial=function(){if(this.material){var t=[];for(var i in this.lightPosList){var e=this.lightPosList[i];t.push(e)}t.push(new h(-1)),this.material.setProperty("circles",t)}},t.worldToScreen=function(t){this._tmpVec3.set(t.x,t.y,0);var i=this.camera.worldToScreen(this._tmpVec3);return new a(this.radio*i.x/this.width,1-this.radio*i.y/this.height)},t.addObstacle=function(t,i){for(var e=[],s=0;s<i.length;s++){var a=this.worldToScreen(i[s]);if(0==s)e.push(new h(Math.ceil(i.length/2),(i.length-1)%2,a.x,a.y));else if(s+1<i.length){var r=this.worldToScreen(i[s+1]);e.push(new h(a.x,a.y,r.x,r.y)),s++}else e.push(new h(a.x,a.y)),s++}this.obstacleList[t]=e,this.updateMatObstacle()},t.removeObstacle=function(t){this.obstacleList[t]=null,this.updateMatObstacle()},t.updateMatObstacle=function(){if(this.material){var t=[];for(var i in this.obstacleList){var e=this.obstacleList[i];if(e)for(var s=0;s<e.length;s++)t.push(e[s])}this.material.setProperty("obstacles",t)}},t}());r.lightPosList={},r.material=void 0,r.width=1280,r.height=720,r.camera=void 0,r.radio=1,r.obstacleList={},r._tmpVec3=new e,i._RF.pop()}}}));

System.register("chunks:///_virtual/SceneLightObstacle.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SceneLightMgr.ts"],(function(t){var e,n,o,i,s,r,c;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,o=t._decorator,i=t.PolygonCollider2D,s=t.NodeEventType,r=t.Component},function(t){c=t.SceneLightMgr}],execute:function(){var l;n._RF.push({},"eafa3ai49ZKOZN80PqTXp9O","SceneLightObstacle",void 0);var a=o.ccclass,h=o.requireComponent;t("SceneLightObstacle",a("SceneLightObstacle")(l=h(i)(l=function(t){function n(){for(var e,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))||this).collider=null,e._timer=null,e}e(n,t);var o=n.prototype;return o.onLoad=function(){this.collider=this.node.getComponent(i)},o.onUpdatePos=function(){this.node.active&&c.addObstacle(this.node.uuid,this.collider.worldPoints)},o.onEnable=function(){var t=this;this._timer=setTimeout((function(){t._timer=null,t.onUpdatePos()}),100),this.node.on(s.TRANSFORM_CHANGED,this.onUpdatePos,this),this.node.parent.on(s.TRANSFORM_CHANGED,this.onUpdatePos,this)},o.onDisable=function(){c.removeObstacle(this.node.uuid),this.node.off(s.TRANSFORM_CHANGED,this.onUpdatePos,this),this.node.parent.off(s.TRANSFORM_CHANGED,this.onUpdatePos,this)},o.onDestroy=function(){this._timer&&(clearTimeout(this._timer),this._timer=null),c.removeObstacle(this.node.uuid)},n}(r))||l)||l);n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});